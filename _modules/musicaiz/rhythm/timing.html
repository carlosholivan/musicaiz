<!DOCTYPE html>
<html class="writer-html5" lang="en" >
<head>
  <meta charset="utf-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>musicaiz.rhythm.timing &mdash; Musicaiz 0.0.2 documentation</title>
      <link rel="stylesheet" href="../../../_static/pygments.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/theme.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/plot_directive.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-binder.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-dataframe.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/sg_gallery-rendered-html.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/design-style.b7bb847fb20b106c3d81b95245e65545.min.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/panels-bootstrap.5fd3999ee7762ccc51105388f4a9d115.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/panels-main.c949a650a448cc0ae9fd3441c0e17fb0.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/panels-variables.06eb56fa6e07937060861dad626602ad.css" type="text/css" />
      <link rel="stylesheet" href="../../../_static/css/custom.css" type="text/css" />
  <!--[if lt IE 9]>
    <script src="../../../_static/js/html5shiv.min.js"></script>
  <![endif]-->
  
        <script data-url_root="../../../" id="documentation_options" src="../../../_static/documentation_options.js"></script>
        <script src="../../../_static/jquery.js"></script>
        <script src="../../../_static/underscore.js"></script>
        <script src="../../../_static/doctools.js"></script>
        <script src="../../../_static/design-tabs.js"></script>
        <script crossorigin="anonymous" integrity="sha256-Ae2Vz/4ePdIu6ZyI/5ZGsYnb+m0JlOmKPjt6XZ9JJkA=" src="https://cdnjs.cloudflare.com/ajax/libs/require.js/2.3.4/require.min.js"></script>
    <script src="../../../_static/js/theme.js"></script>
    <link rel="index" title="Index" href="../../../genindex.html" />
    <link rel="search" title="Search" href="../../../search.html" /> 
</head>

<body class="wy-body-for-nav"> 
  <div class="wy-grid-for-nav">
    <nav data-toggle="wy-nav-shift" class="wy-nav-side">
      <div class="wy-side-scroll">
        <div class="wy-side-nav-search"  style="background: #222222ff" >
            <a href="../../../index.html">
            <img src="../../../_static/logo_square_dark.png" class="logo" alt="Logo"/>
          </a>
              <div class="version">
                0.0.2
              </div>
<div role="search">
  <form id="rtd-search-form" class="wy-form" action="../../../search.html" method="get">
    <input type="text" name="q" placeholder="Search docs" />
    <input type="hidden" name="check_keywords" value="yes" />
    <input type="hidden" name="area" value="default" />
  </form>
</div>
        </div><div class="wy-menu wy-menu-vertical" data-spy="affix" role="navigation" aria-label="Navigation menu">
              <p class="caption" role="heading"><span class="caption-text">Getting Started:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../install.html">Installation instructions</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../introduction.html">Introduction</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Musicaiz Documentation:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../loaders.html">Loaders</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../structure.html">Structure</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../harmony.html">Harmony</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../rhythm.html">Rhythm</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../features.html">Features</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../algorithms.html">Algorithms</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../tokenizers.html">Tokenizers</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../evaluation.html">Evaluation</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../plotters.html">Plotters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../converters.html">Converters</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../datasets.html">Datasets</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../models.html">Models</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">Tutorials:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/2-write_midi.html">Writing a MIDI file from scratch</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../notebooks/3-plot.html">Plotting</a></li>
</ul>
<p class="caption" role="heading"><span class="caption-text">References:</span></p>
<ul>
<li class="toctree-l1"><a class="reference internal" href="../../../implementations.html">Implementation Details</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../genindex.html">Index</a></li>
<li class="toctree-l1"><a class="reference internal" href="../../../glossary.html">Glossary</a></li>
</ul>

        </div>
      </div>
    </nav>

    <section data-toggle="wy-nav-shift" class="wy-nav-content-wrap"><nav class="wy-nav-top" aria-label="Mobile navigation menu"  style="background: #222222ff" >
          <i data-toggle="wy-nav-top" class="fa fa-bars"></i>
          <a href="../../../index.html">Musicaiz</a>
      </nav>

      <div class="wy-nav-content">
        <div class="rst-content">
          <div role="navigation" aria-label="Page navigation">
  <ul class="wy-breadcrumbs">
      <li><a href="../../../index.html" class="icon icon-home"></a> &raquo;</li>
          <li><a href="../../index.html">Module code</a> &raquo;</li>
      <li>musicaiz.rhythm.timing</li>
      <li class="wy-breadcrumbs-aside">
      </li>
  </ul>
  <hr/>
</div>
          <div role="main" class="document" itemscope="itemscope" itemtype="http://schema.org/Article">
           <div itemprop="articleBody">
             
  <h1>Source code for musicaiz.rhythm.timing</h1><div class="highlight"><pre>
<span></span><span class="kn">from</span> <span class="nn">__future__</span> <span class="kn">import</span> <span class="n">annotations</span>
<span class="kn">from</span> <span class="nn">enum</span> <span class="kn">import</span> <span class="n">Enum</span>
<span class="kn">from</span> <span class="nn">typing</span> <span class="kn">import</span> <span class="n">Tuple</span><span class="p">,</span> <span class="n">List</span><span class="p">,</span> <span class="n">Dict</span><span class="p">,</span> <span class="n">Union</span>
<span class="kn">import</span> <span class="nn">numpy</span> <span class="k">as</span> <span class="nn">np</span>


<div class="viewcode-block" id="TimingConsts"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.TimingConsts.html#musicaiz.rhythm.TimingConsts">[docs]</a><span class="k">class</span> <span class="nc">TimingConsts</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Enum contains the default values for timing parameters.</span>

<span class="sd">    RESOLUTION: Sequencer Ticks per quarter note (TPQN) or</span>
<span class="sd">    Pulses per quarter note (PPQ) used in Logic Pro.</span>

<span class="sd">    DEFAULT_BPM: Default Tempo or bpm if no bpm value is known in advance.</span>

<span class="sd">    DEFAULT_TIME_SIGNATURE: Default time signature if it  is not known in advance.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">RESOLUTION</span> <span class="o">=</span> <span class="mi">96</span>
    <span class="n">TICKS_PER_SEC</span> <span class="o">=</span> <span class="mi">192</span>
    <span class="n">DEFAULT_BPM</span> <span class="o">=</span> <span class="mi">120</span>
    <span class="n">DEFAULT_TIME_SIGNATURE</span> <span class="o">=</span> <span class="s2">&quot;4/4&quot;</span></div>


<div class="viewcode-block" id="NoteLengths"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.NoteLengths.html#musicaiz.rhythm.NoteLengths">[docs]</a><span class="k">class</span> <span class="nc">NoteLengths</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Enum contains Note durations in fractions of the whole note.</span>
<span class="sd">    The Enum names correspond to the American notation.</span>
<span class="sd">    From https://www.fransabsil.nl/htm/ticktime.htm</span>

<span class="sd">    Value: Relative value</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DOTTED_WHOLE</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">WHOLE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">DOTTED_HALF</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">HALF</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">2</span>
    <span class="n">DOTTED_QUARTER</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">8</span>
    <span class="n">QUARTER</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">4</span>
    <span class="n">DOTTED_EIGHT</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">EIGHT</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">8</span>
    <span class="n">DOTTED_SIXTEENTH</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">32</span>
    <span class="n">SIXTEENTH</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">16</span>
    <span class="n">DOTTED_THIRTY_SECOND</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">THIRTY_SECOND</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">32</span>
    <span class="n">DOTTED_SIXTY_FOUR</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">128</span>
    <span class="n">SIXTY_FOUR</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">64</span>
    <span class="n">DOTTED_HUNDRED_TWENTY_EIGHT</span> <span class="o">=</span> <span class="mi">3</span> <span class="o">/</span> <span class="mi">256</span>
    <span class="n">HUNDRED_TWENTY_EIGHT</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">128</span>

    <span class="c1"># triplets</span>
    <span class="n">HALF_TRIPLET</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">3</span>
    <span class="n">QUARTER_TRIPLET</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">6</span>
    <span class="n">EIGHT_TRIPLET</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">12</span>
    <span class="n">SIXTEENTH_TRIPLET</span> <span class="o">=</span> <span class="mi">1</span> <span class="o">/</span> <span class="mi">24</span>


    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">fraction</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">value</span>

    <span class="k">def</span> <span class="nf">ticks</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="nb">round</span><span class="p">(</span><span class="n">resolution</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">fraction</span> <span class="o">/</span> <span class="n">NoteLengths</span><span class="o">.</span><span class="n">QUARTER</span><span class="o">.</span><span class="n">fraction</span><span class="p">)</span>

    <span class="k">def</span> <span class="nf">ms</span><span class="p">(</span>
        <span class="bp">self</span><span class="p">,</span>
        <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_BPM</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
        <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">ms_per_tick</span><span class="p">(</span><span class="n">bpm</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">ticks</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
    
    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_note_ticks_mapping</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">triplets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
        <span class="n">dict_notes</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="k">for</span> <span class="n">note_dur</span> <span class="ow">in</span> <span class="nb">list</span><span class="p">(</span><span class="bp">cls</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">keys</span><span class="p">()):</span>
            <span class="k">if</span> <span class="ow">not</span> <span class="n">triplets</span><span class="p">:</span>
            <span class="c1"># remove triplet durations (optional)</span>
                <span class="k">if</span> <span class="s2">&quot;TRIPLET&quot;</span> <span class="ow">in</span> <span class="n">note_dur</span><span class="p">:</span>
                    <span class="k">continue</span>
            <span class="n">dict_notes</span><span class="o">.</span><span class="n">update</span><span class="p">({</span><span class="n">note_dur</span><span class="p">:</span> <span class="bp">cls</span><span class="p">[</span><span class="n">note_dur</span><span class="p">]</span><span class="o">.</span><span class="n">ticks</span><span class="p">()})</span>
        <span class="k">return</span> <span class="n">dict_notes</span></div>


<span class="k">class</span> <span class="nc">SymbolicNoteLengths</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This Enum contains Note symbols as unicode strings.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="n">DOTTED_WHOLE</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15D</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">WHOLE</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15D</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_HALF</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15E</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">HALF</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15E</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_QUARTER</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15F</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">QUARTER</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15F</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_EIGHT</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D160</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">EIGHT</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D160</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_SIXTEENTH</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D161</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">SIXTEENTH</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D161</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_THIRTY_SECOND</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D162</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">THIRTY_SECOND</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D162</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_SIXTY_FOUR</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D163</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">SIXTY_FOUR</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D163</span><span class="s2">&quot;</span>
    <span class="n">DOTTED_HUNDRED_TWENTY_EIGHT</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D164</span><span class="s2">&quot;</span> <span class="o">+</span> <span class="s2">&quot;.&quot;</span>
    <span class="n">HUNDRED_TWENTY_EIGHT</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D164</span><span class="s2">&quot;</span>

    <span class="c1"># triplets</span>
    <span class="n">HALF_TRIPLET</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15E\U000000B3</span><span class="s2">&quot;</span>
    <span class="n">QUARTER_TRIPLET</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D15F\U000000B3</span><span class="s2">&quot;</span>
    <span class="n">EIGHT_TRIPLET</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D160\U000000B3</span><span class="s2">&quot;</span>
    <span class="n">SIXTEENTH_TRIPLET</span> <span class="o">=</span> <span class="sa">u</span><span class="s2">&quot;</span><span class="se">\U0001D161\U000000B3</span><span class="s2">&quot;</span>


<span class="k">class</span> <span class="nc">TimeSigDenominators</span><span class="p">(</span><span class="n">Enum</span><span class="p">):</span>
    <span class="sd">&quot;&quot;&quot;This Enum contains the possible time signature denominators.&quot;&quot;&quot;</span>
    <span class="n">WHOLE</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">HALF</span> <span class="o">=</span> <span class="mi">2</span>
    <span class="n">QUARTER</span> <span class="o">=</span> <span class="mi">4</span>
    <span class="n">EIGHT</span> <span class="o">=</span> <span class="mi">8</span>
    <span class="n">SIXTEENTH</span> <span class="o">=</span> <span class="mi">16</span>
    <span class="n">THIRTY_SECOND</span> <span class="o">=</span> <span class="mi">32</span>
    <span class="n">SIXTY_FOUR</span> <span class="o">=</span> <span class="mi">64</span>
    <span class="n">HUNDRED_TWENTY_EIGHTH</span> <span class="o">=</span> <span class="mi">128</span>

    <span class="nd">@classmethod</span>
    <span class="k">def</span> <span class="nf">get_note_length</span><span class="p">(</span><span class="bp">cls</span><span class="p">,</span> <span class="n">denominator</span><span class="p">:</span> <span class="nb">int</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="n">TimeSigDenominators</span><span class="p">:</span>
        <span class="n">got</span> <span class="o">=</span> <span class="kc">None</span>
        <span class="k">for</span> <span class="n">note</span> <span class="ow">in</span> <span class="bp">cls</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">values</span><span class="p">():</span>
            <span class="k">if</span> <span class="n">note</span><span class="o">.</span><span class="n">value</span> <span class="o">==</span> <span class="n">denominator</span><span class="p">:</span>
                <span class="n">got</span> <span class="o">=</span> <span class="n">note</span>
                <span class="k">return</span> <span class="n">got</span>
        <span class="k">if</span> <span class="n">got</span> <span class="ow">is</span> <span class="kc">None</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Not note found for </span><span class="si">{</span><span class="n">denominator</span><span class="si">}</span><span class="s2"> denominator.&quot;</span><span class="p">)</span>


<div class="viewcode-block" id="TimeSignature"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.TimeSignature.html#musicaiz.rhythm.TimeSignature">[docs]</a><span class="k">class</span> <span class="nc">TimeSignature</span><span class="p">:</span>

<div class="viewcode-block" id="TimeSignature.__init__"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.TimeSignature.html#musicaiz.rhythm.TimeSignature.__init__">[docs]</a>    <span class="k">def</span> <span class="fm">__init__</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">time_sig</span><span class="p">:</span> <span class="n">Union</span><span class="p">[</span><span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">],</span> <span class="nb">str</span><span class="p">]):</span>
        <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">        TimeSignature class for representing time signatures.</span>

<span class="sd">        Parameters</span>
<span class="sd">        ----------</span>
<span class="sd">            time_sig: str</span>
<span class="sd">                The time signature in the format num/den</span>
<span class="sd">        &quot;&quot;&quot;</span>
        <span class="k">if</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_sig</span><span class="p">,</span> <span class="nb">str</span><span class="p">):</span>
            <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">time_sig</span><span class="p">:</span>
                <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time signature </span><span class="si">{</span><span class="n">time_sig</span><span class="si">}</span><span class="s2"> is not in the correct format.&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_sig</span> <span class="o">=</span> <span class="n">time_sig</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span> <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="bp">self</span><span class="o">.</span><span class="n">time_sig</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">)</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">)</span>
        <span class="k">elif</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">time_sig</span><span class="p">,</span> <span class="nb">tuple</span><span class="p">):</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">time_sig</span> <span class="o">=</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span> <span class="o">+</span> <span class="s2">&quot;/&quot;</span> <span class="o">+</span> <span class="nb">str</span><span class="p">(</span><span class="n">time_sig</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_sig</span><span class="p">[</span><span class="mi">0</span><span class="p">])</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denom</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">time_sig</span><span class="p">[</span><span class="mi">1</span><span class="p">])</span>
        <span class="k">else</span><span class="p">:</span>
            <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Time signature </span><span class="si">{</span><span class="n">time_sig</span><span class="si">}</span><span class="s2"> is not in the correct format.&quot;</span><span class="p">)</span></div>

    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beats_per_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">beat_type</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
        <span class="k">return</span> <span class="n">TimeSigDenominators</span><span class="o">.</span><span class="n">get_note_length</span><span class="p">(</span><span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">)</span><span class="o">.</span><span class="n">name</span>
    
    <span class="k">def</span> <span class="nf">_notes_per_bar</span><span class="p">(</span><span class="bp">self</span><span class="p">,</span> <span class="n">note_name</span><span class="p">:</span> <span class="nb">str</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="n">NoteLengths</span><span class="p">[</span><span class="n">note_name</span><span class="p">]</span><span class="o">.</span><span class="n">value</span><span class="p">)</span> <span class="o">*</span> <span class="bp">self</span><span class="o">.</span><span class="n">num</span> <span class="o">*</span> <span class="p">(</span><span class="mi">1</span> <span class="o">/</span> <span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">quarters</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="c1"># Get the name of the denominator note: NoteLengths(1 / self.denom).name</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes_per_bar</span><span class="p">(</span><span class="s2">&quot;QUARTER&quot;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">eights</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes_per_bar</span><span class="p">(</span><span class="s2">&quot;EIGHT&quot;</span><span class="p">)</span>
    
    <span class="nd">@property</span>
    <span class="k">def</span> <span class="nf">sixteenths</span><span class="p">(</span><span class="bp">self</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">int</span><span class="p">:</span>
        <span class="k">return</span> <span class="bp">self</span><span class="o">.</span><span class="n">_notes_per_bar</span><span class="p">(</span><span class="s2">&quot;SIXTEENTH&quot;</span><span class="p">)</span>
    
    <span class="k">def</span> <span class="fm">__repr__</span><span class="p">(</span><span class="bp">self</span><span class="p">):</span>
        <span class="k">return</span> <span class="s2">&quot;TimeSig(num=</span><span class="si">{}</span><span class="s2">, den=&#39;</span><span class="si">{}</span><span class="s2">&#39;)&quot;</span><span class="o">.</span><span class="n">format</span><span class="p">(</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">num</span><span class="p">,</span>
            <span class="bp">self</span><span class="o">.</span><span class="n">denom</span><span class="p">,</span>
        <span class="p">)</span></div>



<span class="c1"># TODO: Refactor all these functions to a class with bpm and resolution as attributes?</span>
<span class="c1"># We are repeating so many times the bpm and resolution input args</span>
<div class="viewcode-block" id="ms_per_tick"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.ms_per_tick.html#musicaiz.rhythm.ms_per_tick">[docs]</a><span class="k">def</span> <span class="nf">ms_per_tick</span><span class="p">(</span>
    <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_BPM</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the miliseconds that correspond to one tick.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    bpm: int</span>
<span class="sd">        the tempo or bpms.</span>

<span class="sd">    resolution: int</span>
<span class="sd">        the pulses o ticks per quarter note (PPQ or TPQN).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    float</span>
<span class="sd">        The miliseconds that correspond to a tick.</span>
<span class="sd">    &quot;&quot;&quot;</span>
    <span class="k">return</span> <span class="mi">60000</span> <span class="o">/</span> <span class="p">(</span><span class="n">bpm</span> <span class="o">*</span> <span class="n">resolution</span><span class="p">)</span></div>


<div class="viewcode-block" id="ms_per_note"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.ms_per_note.html#musicaiz.rhythm.ms_per_note">[docs]</a><span class="k">def</span> <span class="nf">ms_per_note</span><span class="p">(</span>
    <span class="n">note_length</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;quarter&quot;</span><span class="p">,</span>
    <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_BPM</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the miliseconds that correspond to one note.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    note_length: str</span>
<span class="sd">        the name of the note length in american notation.</span>

<span class="sd">    bpm: int</span>
<span class="sd">        the tempo or bpms.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    float</span>
<span class="sd">        The miliseconds that correspond to a note length.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">return</span> <span class="n">NoteLengths</span><span class="p">[</span><span class="n">note_length</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span><span class="o">.</span><span class="n">ms</span><span class="p">(</span><span class="n">bpm</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span></div>


<div class="viewcode-block" id="ticks_per_bar"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.ticks_per_bar.html#musicaiz.rhythm.ticks_per_bar">[docs]</a><span class="k">def</span> <span class="nf">ticks_per_bar</span><span class="p">(</span>
    <span class="n">time_sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_TIME_SIGNATURE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the ticks that correspond to one beat and bar.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ticks_beat: int</span>
<span class="sd">        number of ticks in a beat of the bar.</span>

<span class="sd">    ticks_bar: int</span>
<span class="sd">        number of ticks in a bar.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="c1"># There are measures with beats or subdivisions lower or higher than a quarter note.</span>
    <span class="c1"># The number of beats per measure is given by the 1st value of the `measure` tuple.</span>
    <span class="c1"># The beat figure (quarter note, 16th note...) is given by the 2nd value of the `measure` tuple.</span>
    <span class="n">n</span><span class="p">,</span> <span class="n">d</span> <span class="o">=</span> <span class="n">_bar_str_to_tuple</span><span class="p">(</span><span class="n">time_sig</span><span class="p">)</span>
    <span class="c1"># Find the note corresponding note to the value of the time sig. denominator</span>
    <span class="n">note_length</span> <span class="o">=</span> <span class="n">TimeSigDenominators</span><span class="o">.</span><span class="n">get_note_length</span><span class="p">(</span><span class="n">d</span><span class="p">)</span>
    <span class="c1"># That note is the beat, so we get now the ticks in that beat</span>
    <span class="n">ticks_beat</span> <span class="o">=</span> <span class="n">NoteLengths</span><span class="p">[</span><span class="n">note_length</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">ticks</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
    <span class="c1"># The numerator gives us how many beats are in the bar</span>
    <span class="n">ticks_bar</span> <span class="o">=</span> <span class="n">n</span> <span class="o">*</span> <span class="n">ticks_beat</span>
    <span class="k">return</span> <span class="n">ticks_beat</span><span class="p">,</span> <span class="n">ticks_bar</span></div>


<span class="k">def</span> <span class="nf">ms_per_bar</span><span class="p">(</span>
    <span class="n">time_sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_TIME_SIGNATURE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_BPM</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">float</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;This function calculates the miliseconds that correspond to one bar.</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    time_sig: str</span>
<span class="sd">        the time signature as a fraction.</span>

<span class="sd">    bpm: int</span>
<span class="sd">        the tempo or bpms.</span>

<span class="sd">    resolution: int</span>
<span class="sd">        the pulses o ticks per quarter note (PPQ or TPQN).</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    ms_beat: float</span>
<span class="sd">        number of miliseconds in a beat of the bar.</span>

<span class="sd">    ms_bar: float</span>
<span class="sd">        number of miliseconds in a bar.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">ticks_beat</span><span class="p">,</span> <span class="n">ticks_bar</span> <span class="o">=</span> <span class="n">ticks_per_bar</span><span class="p">(</span><span class="n">time_sig</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">ms_tick</span> <span class="o">=</span> <span class="n">ms_per_tick</span><span class="p">(</span><span class="n">bpm</span><span class="p">,</span> <span class="n">resolution</span><span class="p">)</span>
    <span class="n">ms_beat</span><span class="p">,</span> <span class="n">ms_bar</span> <span class="o">=</span> <span class="n">ticks_beat</span> <span class="o">*</span> <span class="n">ms_tick</span><span class="p">,</span> <span class="n">ticks_bar</span> <span class="o">*</span> <span class="n">ms_tick</span>
    <span class="k">return</span> <span class="n">ms_beat</span><span class="p">,</span> <span class="n">ms_bar</span>


<div class="viewcode-block" id="_bar_str_to_tuple"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm._bar_str_to_tuple.html#musicaiz.rhythm._bar_str_to_tuple">[docs]</a><span class="k">def</span> <span class="nf">_bar_str_to_tuple</span><span class="p">(</span>
    <span class="n">time_sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="s2">&quot;4/4&quot;</span><span class="p">,</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">Tuple</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">int</span><span class="p">]:</span>
    <span class="sd">&quot;&quot;&quot;This function converts the time signature str to a tuple of</span>
<span class="sd">    2 values: numerator and denominator.&quot;&quot;&quot;</span>
    <span class="k">if</span> <span class="s2">&quot;/&quot;</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">time_sig</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Not valid time signature format. Time sig must have &#39;/&#39;&quot;</span><span class="p">)</span>
    <span class="n">numerator</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">time_sig</span><span class="o">.</span><span class="n">split</span><span class="p">(</span><span class="s2">&quot;/&quot;</span><span class="p">)</span>
    <span class="k">return</span> <span class="nb">int</span><span class="p">(</span><span class="n">numerator</span><span class="p">),</span> <span class="nb">int</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span></div>


<div class="viewcode-block" id="get_subdivisions"><a class="viewcode-back" href="../../../generated/musicaiz.rhythm.get_subdivisions.html#musicaiz.rhythm.get_subdivisions">[docs]</a><span class="k">def</span> <span class="nf">get_subdivisions</span><span class="p">(</span>
    <span class="n">total_bars</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span>
    <span class="n">subdivision</span><span class="p">:</span> <span class="nb">str</span><span class="p">,</span>  <span class="c1"># TODO: give possible values here</span>
    <span class="n">time_sig</span><span class="p">:</span> <span class="nb">str</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_TIME_SIGNATURE</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">bpm</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">DEFAULT_BPM</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">resolution</span><span class="p">:</span> <span class="nb">int</span> <span class="o">=</span> <span class="n">TimingConsts</span><span class="o">.</span><span class="n">RESOLUTION</span><span class="o">.</span><span class="n">value</span><span class="p">,</span>
    <span class="n">absolute_timing</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">True</span>
<span class="p">)</span> <span class="o">-&gt;</span> <span class="n">List</span><span class="p">[</span><span class="n">Dict</span><span class="p">[</span><span class="nb">str</span><span class="p">,</span> <span class="n">Union</span><span class="p">[</span><span class="nb">int</span><span class="p">,</span> <span class="nb">float</span><span class="p">]]]:</span>

    <span class="sd">&quot;&quot;&quot;</span>
<span class="sd">    This method returns the grid (vertical lines) for quantizing notes</span>
<span class="sd">    of a determined number of measures given by `total_bars`.</span>
<span class="sd">    The lines are plotted in each beat subdivision.</span>
<span class="sd">    Each line has the format m.b.s.:</span>
<span class="sd">    m: measure</span>
<span class="sd">    b: beat</span>
<span class="sd">    s: subdivision</span>
<span class="sd">    Ex.: subdivision = 8 is an 8th note</span>

<span class="sd">    Parameters</span>
<span class="sd">    ----------</span>

<span class="sd">    total_bars: int</span>
<span class="sd">        the number of bars.</span>

<span class="sd">    subdivision: str</span>
<span class="sd">        the note subdivision. Ex.: quarter, eight...</span>
<span class="sd">        Note that we cannot have a subdivision greater than the beat nor a</span>
<span class="sd">        non value of the beat note. If the beat corresponds to a quarter note</span>
<span class="sd">        (X/4 time sigs.), the subdivision has to be a note shorter than the quarter note</span>
<span class="sd">        but half or 4 times less than the beat (eight, sixteenth note...).</span>

<span class="sd">    time_sig: str</span>
<span class="sd">        the time signature as a fraction.</span>

<span class="sd">    bpm: int</span>
<span class="sd">        the tempo or bpms.</span>

<span class="sd">    resolution: int</span>
<span class="sd">        the pulses o ticks per quarter note (PPQ or TPQN).</span>
<span class="sd">    </span>
<span class="sd">    absolute_timing: bool</span>
<span class="sd">        default is True. This allows to initialize note time arguments in absolute (True) or</span>
<span class="sd">        relative time units (False). Relative units means that each bar will start at 0 seconds</span>
<span class="sd">        and ticks, so the note timing attributes will be relative to the bar start equals to 0.</span>

<span class="sd">    Returns</span>
<span class="sd">    -------</span>

<span class="sd">    beat_subdivs: List[Dict[str, Union[int, float]]]</span>
<span class="sd">        each element in the list is a subdivision. The subdivision dict key&#39;s are:</span>

<span class="sd">        `bar`: the bar index in the total_bars of the subdivision.</span>

<span class="sd">        `piece_beat`: the beat index corresponding to the subdivision in the total_bars or piece.</span>

<span class="sd">        `piece_subdivision`: the subdivision index corresponding to the total number of</span>
<span class="sd">        subdivisions in the total_bars or piece.</span>

<span class="sd">        `bar_beat`: the beat index corresponding to the subdivision in its bar.</span>

<span class="sd">        `bar_subdivision`: the subdivision index corresponding to its bar.</span>

<span class="sd">        `ticks`: the ticks value of where the subdivision starts.</span>

<span class="sd">        `sec`: the secs value of where the subdivision starts.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="k">if</span> <span class="n">total_bars</span> <span class="o">&lt;=</span> <span class="mi">0</span> <span class="ow">or</span> <span class="nb">isinstance</span><span class="p">(</span><span class="n">total_bars</span><span class="p">,</span> <span class="nb">float</span><span class="p">):</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="s2">&quot;Total number of bars must be a positive integer.&quot;</span><span class="p">)</span>

    <span class="n">beats_bar</span><span class="p">,</span> <span class="n">denominator</span> <span class="o">=</span> <span class="n">_bar_str_to_tuple</span><span class="p">(</span><span class="n">time_sig</span><span class="p">)</span>

    <span class="c1"># Get the note length</span>
    <span class="n">note_length</span> <span class="o">=</span> <span class="n">TimeSigDenominators</span><span class="o">.</span><span class="n">get_note_length</span><span class="p">(</span><span class="n">denominator</span><span class="p">)</span>

    <span class="c1"># Get the ticks in a beat</span>
    <span class="n">ticks_beat</span> <span class="o">=</span> <span class="n">NoteLengths</span><span class="p">[</span><span class="n">note_length</span><span class="o">.</span><span class="n">name</span><span class="p">]</span><span class="o">.</span><span class="n">ticks</span><span class="p">(</span><span class="n">resolution</span><span class="p">)</span>
    <span class="n">ms_beat</span> <span class="o">=</span> <span class="n">ms_per_note</span><span class="p">(</span><span class="n">note_length</span><span class="o">.</span><span class="n">name</span><span class="o">.</span><span class="n">lower</span><span class="p">(),</span> <span class="n">bpm</span><span class="p">)</span>

    <span class="c1"># Get the subdivision note</span>
    <span class="n">subdiv_note</span> <span class="o">=</span> <span class="n">TimeSigDenominators</span><span class="p">[</span><span class="n">subdivision</span><span class="o">.</span><span class="n">upper</span><span class="p">()]</span>

    <span class="c1"># Subdivision note has to be 2, 4, 8...times less than the beat</span>
    <span class="c1"># Subdivision must be in the subdivisions possible values (strs)</span>
    <span class="k">if</span> <span class="n">subdivision</span><span class="o">.</span><span class="n">upper</span><span class="p">()</span> <span class="ow">not</span> <span class="ow">in</span> <span class="n">TimeSigDenominators</span><span class="o">.</span><span class="n">__members__</span><span class="o">.</span><span class="n">keys</span><span class="p">():</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Subdivision </span><span class="si">{</span><span class="n">subdivision</span><span class="si">}</span><span class="s2"> does not exist.&quot;</span><span class="p">)</span>
    <span class="k">if</span> <span class="n">subdiv_note</span><span class="o">.</span><span class="n">value</span> <span class="o">%</span> <span class="n">note_length</span><span class="o">.</span><span class="n">value</span> <span class="o">!=</span> <span class="mi">0</span><span class="p">:</span>
        <span class="k">raise</span> <span class="ne">ValueError</span><span class="p">(</span><span class="sa">f</span><span class="s2">&quot;Input subdivision </span><span class="si">{</span><span class="n">subdivision</span><span class="si">}</span><span class="s2"> is not valid for beat note </span><span class="si">{</span><span class="n">note_length</span><span class="o">.</span><span class="n">name</span><span class="si">}</span><span class="s2">.&quot;</span><span class="p">)</span>

    <span class="c1"># Get how many of these subdivision notes are in a beat</span>
    <span class="n">subdivs_beat</span> <span class="o">=</span> <span class="n">subdiv_note</span><span class="o">.</span><span class="n">value</span> <span class="o">//</span> <span class="n">note_length</span><span class="o">.</span><span class="n">value</span>
    <span class="n">subdivs_bar</span> <span class="o">=</span> <span class="n">beats_bar</span> <span class="o">*</span> <span class="n">subdivs_beat</span>
    <span class="n">ticks_subdiv</span> <span class="o">=</span> <span class="n">ticks_beat</span> <span class="o">//</span> <span class="n">subdivs_beat</span>
    <span class="n">ms_subdiv</span> <span class="o">=</span> <span class="n">ms_beat</span> <span class="o">/</span> <span class="n">subdivs_beat</span>

    <span class="c1"># total beats in the grid (vertical lines) are the measures * number of beats per measure</span>
    <span class="n">total_beats</span> <span class="o">=</span> <span class="n">total_bars</span> <span class="o">*</span> <span class="n">beats_bar</span>
    <span class="n">total_beat_subdivs</span> <span class="o">=</span> <span class="n">total_beats</span> <span class="o">*</span> <span class="n">subdivs_beat</span>

    <span class="c1"># Calculate the ticks where each subdivision starts.</span>
    <span class="c1"># That will be the horizontal position of the vertical or grid lines.</span>
    <span class="n">beat_subdivs</span> <span class="o">=</span> <span class="p">[]</span>
    <span class="n">measure_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">beat_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="n">beat_bar_index</span> <span class="o">=</span> <span class="mi">1</span>
    <span class="k">for</span> <span class="n">beat_subdiv_index</span> <span class="ow">in</span> <span class="nb">range</span><span class="p">(</span><span class="n">total_beat_subdivs</span><span class="p">):</span>
        <span class="n">beat_subdivision</span> <span class="o">=</span> <span class="p">{}</span>
        <span class="n">measure_div</span> <span class="o">=</span> <span class="n">beat_subdiv_index</span> <span class="o">%</span> <span class="n">subdivs_bar</span>
        <span class="n">beat_div</span> <span class="o">=</span> <span class="n">beat_subdiv_index</span> <span class="o">%</span> <span class="n">subdivs_beat</span>
        <span class="k">if</span> <span class="n">measure_div</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">beat_subdiv_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">measure_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beat_bar_index</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">if</span> <span class="n">beat_div</span> <span class="o">==</span> <span class="mi">0</span> <span class="ow">and</span> <span class="ow">not</span> <span class="n">beat_subdiv_index</span> <span class="o">==</span> <span class="mi">0</span><span class="p">:</span>
            <span class="n">beat_index</span> <span class="o">+=</span> <span class="mi">1</span>
            <span class="n">beat_bar_index</span> <span class="o">+=</span> <span class="mi">1</span>

        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure_index</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;piece_beat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beat_index</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;piece_subdivision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beat_subdiv_index</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;bar_beat&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">beat_bar_index</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;bar_subdivision&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">measure_div</span> <span class="o">+</span> <span class="mi">1</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;ticks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="nb">int</span><span class="p">(</span><span class="n">ticks_subdiv</span> <span class="o">*</span> <span class="n">beat_subdiv_index</span><span class="p">)</span>
        <span class="n">beat_subdivision</span><span class="p">[</span><span class="s2">&quot;sec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">ms_subdiv</span> <span class="o">*</span> <span class="n">beat_subdiv_index</span> <span class="o">/</span> <span class="mi">1000</span>
        <span class="n">beat_subdivs</span><span class="o">.</span><span class="n">append</span><span class="p">(</span><span class="n">beat_subdivision</span><span class="p">)</span>

    <span class="c1"># update ticks and sec values if absolute_timing is not True</span>
    <span class="k">if</span> <span class="ow">not</span> <span class="n">absolute_timing</span><span class="p">:</span>
        <span class="c1"># for the convention used, the 1st element in the dict `beat_subdivs`</span>
        <span class="c1"># has a &quot;bar&quot; value of 1 (not 0), so we&#39;ll start in the else statement</span>
        <span class="n">prev_bar</span> <span class="o">=</span> <span class="mi">0</span>
        <span class="k">for</span> <span class="n">subdiv</span> <span class="ow">in</span> <span class="n">beat_subdivs</span><span class="p">:</span>
            <span class="k">if</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span> <span class="o">==</span> <span class="n">prev_bar</span><span class="p">:</span>
                <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;ticks&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;ticks&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bar_start_ticks</span>
                <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;sec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;sec&quot;</span><span class="p">]</span> <span class="o">-</span> <span class="n">bar_start_sec</span>
            <span class="k">else</span><span class="p">:</span>
                <span class="n">bar_start_ticks</span><span class="p">,</span> <span class="n">bar_start_sec</span> <span class="o">=</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;ticks&quot;</span><span class="p">],</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;sec&quot;</span><span class="p">]</span>
                <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;ticks&quot;</span><span class="p">],</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;sec&quot;</span><span class="p">]</span> <span class="o">=</span> <span class="mi">0</span><span class="p">,</span> <span class="mi">0</span>
                <span class="n">prev_bar</span> <span class="o">=</span> <span class="n">subdiv</span><span class="p">[</span><span class="s2">&quot;bar&quot;</span><span class="p">]</span>

    <span class="k">return</span> <span class="n">beat_subdivs</span></div>


<span class="k">def</span> <span class="nf">get_symbolic_duration</span><span class="p">(</span><span class="n">duration</span><span class="p">:</span> <span class="nb">int</span><span class="p">,</span> <span class="n">triplets</span><span class="p">:</span> <span class="nb">bool</span> <span class="o">=</span> <span class="kc">False</span><span class="p">)</span> <span class="o">-&gt;</span> <span class="nb">str</span><span class="p">:</span>
    <span class="sd">&quot;&quot;&quot;Given a note duration in ticks it calculates its symbolic</span>
<span class="sd">    duration: half, quarter, dotted_half...</span>
<span class="sd">    </span>
<span class="sd">    Parameters</span>
<span class="sd">    -----------</span>

<span class="sd">    triplets: bool</span>
<span class="sd">        default is False. It takes (True) or not (False) into account</span>
<span class="sd">        triplets durations.</span>
<span class="sd">    &quot;&quot;&quot;</span>

    <span class="n">all_notes_ticks</span> <span class="o">=</span> <span class="n">NoteLengths</span><span class="o">.</span><span class="n">get_note_ticks_mapping</span><span class="p">(</span><span class="n">triplets</span><span class="p">)</span>
    <span class="n">notes_ticks</span> <span class="o">=</span> <span class="n">all_notes_ticks</span>

    <span class="c1"># look for the closest note in the notes ticks dict</span>
    <span class="c1"># the closest note will be the selected note even if its</span>
    <span class="c1"># duration in ticks is not exactly equal to the theoretical note ticks</span>
    <span class="n">arr</span> <span class="o">=</span> <span class="n">np</span><span class="o">.</span><span class="n">asarray</span><span class="p">(</span><span class="nb">list</span><span class="p">(</span><span class="n">notes_ticks</span><span class="o">.</span><span class="n">values</span><span class="p">()))</span>
    <span class="n">i</span> <span class="o">=</span> <span class="p">(</span><span class="n">np</span><span class="o">.</span><span class="n">abs</span><span class="p">(</span><span class="n">arr</span> <span class="o">-</span> <span class="n">duration</span><span class="p">))</span><span class="o">.</span><span class="n">argmin</span><span class="p">()</span>
    <span class="n">symbolic_duration</span> <span class="o">=</span> <span class="nb">list</span><span class="p">(</span><span class="n">notes_ticks</span><span class="o">.</span><span class="n">keys</span><span class="p">())[</span><span class="n">i</span><span class="p">]</span>
    <span class="k">return</span> <span class="n">symbolic_duration</span>
</pre></div>

           </div>
          </div>
          <footer>

  <hr/>

  <div role="contentinfo">
    <p>&#169; Copyright 2022, Carlos Hernandez-Olivan.</p>
  </div>

  Built with <a href="https://www.sphinx-doc.org/">Sphinx</a> using a
    <a href="https://github.com/readthedocs/sphinx_rtd_theme">theme</a>
    provided by <a href="https://readthedocs.org">Read the Docs</a>.
   

</footer>
        </div>
      </div>
    </section>
  </div>
  <script>
      jQuery(function () {
          SphinxRtdTheme.Navigation.enable(true);
      });
  </script> 

</body>
</html>